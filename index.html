<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Dobby Fitness Agent</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{--bg:#000;--card:#0a0a0a;--text:#fff;--muted:#9b9b9b;--line:#1a1a1a;--accent:#fff}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
.wrap{max-width:1100px;margin:0 auto;padding:28px}
.header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:10px}
.brand{display:flex;align-items:center;gap:12px}
.title{font-weight:800;font-size:28px;letter-spacing:.2px;color:#fff}
.sub{color:var(--muted);font-size:14px}
.grid{display:grid;grid-template-columns:1.2fr 1fr;gap:18px;margin-top:18px}
.card{background:var(--card);border:1px solid var(--line);border-radius:18px}
.in{padding:18px}
label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
input,select,button,textarea{width:100%;border-radius:10px;border:1px solid var(--line);background:#0e0e0e;color:var(--text);padding:12px 12px;font-size:14px}
button{cursor:pointer;background:#fff;border:1px solid #fff;color:#000;font-weight:800;letter-spacing:.2px}
button:disabled{opacity:.55;cursor:not-allowed}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.hr{height:1px;background:var(--line);margin:14px 0}
.panel{background:#0e0e0e;border:1px solid var(--line);border-radius:14px;padding:12px}
.panel.ok{border-color:#2b2b2b;background:#0f0f0f}
.panel.warn{border-color:#2b2b2b;background:#0f0f0f;color:#d6d6d6}
.panel.err{border-color:#2b2b2b;background:#0f0f0f;color:#ffdddd}
.kv{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.h{font-weight:800;margin:0 0 8px 0}
.plan{white-space:pre-wrap;line-height:1.6}
.split{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;margin-top:18px}
.hidden{display:none}
.footer{margin-top:22px;color:var(--muted);font-size:12px}
.apirow{display:grid;grid-template-columns:1fr auto;gap:10px}
.btn-outline{background:#000;border-color:#fff;color:#fff}
.tagrow{display:flex;gap:8px;flex-wrap:wrap}
.tag{border:1px solid var(--line);padding:8px 10px;border-radius:999px;font-size:12px;color:#d9d9d9;background:#0e0e0e}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="brand">
      <div class="title">Dobby Fitness Agent</div>
    </div>
    <div class="sub">Dobby</div>
  </div>

  <div class="grid">
    <div class="card">
      <div class="in">
        <div class="h">API</div>
        <div class="apirow">
          <input id="apiKey" type="password" placeholder="Enter your Dobby API key">
          <button id="checkBtn" class="btn-outline">Check</button>
        </div>
        <div id="apiNote" class="panel warn hidden"></div>
        <div class="hr"></div>
        <div class="h">Profile</div>
        <div class="row">
          <div><label>Age</label><input id="age" type="number" min="10" max="100" value="24"></div>
          <div><label>Sex</label><select id="sex"><option>Male</option><option>Female</option><option>Other</option></select></div>
        </div>
        <div class="row">
          <div><label>Height (cm)</label><input id="height" type="number" min="100" max="250" step="0.1" value="175"></div>
          <div><label>Weight (kg)</label><input id="weight" type="number" min="20" max="300" step="0.1" value="70"></div>
        </div>
        <div class="row">
          <div><label>Activity Level</label><select id="activity"><option>Sedentary</option><option>Lightly Active</option><option>Moderately Active</option><option>Very Active</option><option>Extremely Active</option></select></div>
          <div><label>Dietary Preference</label><select id="diet"><option>Vegetarian</option><option>Keto</option><option>Gluten Free</option><option>Low Carb</option><option>Dairy Free</option></select></div>
        </div>
        <div><label>Fitness Goal</label><select id="goal"><option>Lose Weight</option><option>Gain Muscle</option><option>Endurance</option><option>Stay Fit</option><option>Strength Training</option></select></div>
        <div class="hr"></div>
        <button id="gen">Generate Plan</button>
        <div id="status" class="panel hidden"></div>
      </div>
    </div>

    <div class="card">
      <div class="in">
        <div class="h">Notes</div>
        <div class="panel warn">General guidance only.</div>
        <div class="hr"></div>
        <div class="h">Basics</div>
        <div class="tagrow">
          <div class="tag">Hydration</div>
          <div class="tag">Protein</div>
          <div class="tag">Sleep</div>
          <div class="tag">Consistency</div>
          <div class="tag">Form</div>
        </div>
      </div>
    </div>
  </div>

  <div class="split">
    <div class="card">
      <div class="in">
        <div class="h">Diet Plan</div>
        <div class="kv" style="margin-top:8px">
          <div class="panel ok">High-protein, balanced fats, controlled carbs.</div>
          <div class="panel ok">Adjust portions to energy needs.</div>
        </div>
        <div id="dietPlan" class="plan" style="margin-top:10px"></div>
      </div>
    </div>
    <div class="card">
      <div class="in">
        <div class="h">Fitness Plan</div>
        <div class="kv" style="margin-top:8px">
          <div class="panel ok">Progressive overload and recovery.</div>
          <div class="panel ok">Warm-up and cooldown each session.</div>
        </div>
        <div id="fitPlan" class="plan" style="margin-top:10px"></div>
      </div>
    </div>
  </div>

</div>

<script>
const FW_URL="https://api.fireworks.ai/inference/v1/chat/completions"
const MODEL="accounts/sentientfoundation/models/dobby-unhinged-llama-3-3-70b-new"

function ui(el,show,cls,msg){
  el.classList.remove("hidden","ok","warn","err")
  if(!show){el.classList.add("hidden");return}
  if(cls) el.classList.add(cls)
  if(msg!==undefined) el.textContent=msg
}

function mdToHtml(s){
  return s.replace(/^###### (.*)$/gm,"<h6>$1</h6>").replace(/^##### (.*)$/gm,"<h5>$1</h5>").replace(/^#### (.*)$/gm,"<h4>$1</h4>").replace(/^### (.*)$/gm,"<h3>$1</h3>").replace(/^## (.*)$/gm,"<h2>$1</h2>").replace(/^# (.*)$/gm,"<h1>$1</h1>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/^- (.*)$/gm,"â€¢ $1").replace(/\n/g,"<br>")
}

async function callFireworks(messages,key,temperature){
  const body={model:MODEL,max_tokens:2048,top_p:1,top_k:40,presence_penalty:0,frequency_penalty:0,temperature:temperature??0.6,messages}
  const r=await fetch(FW_URL,{method:"POST",headers:{"Accept":"application/json","Content-Type":"application/json","Authorization":"Bearer "+key},body:JSON.stringify(body)})
  if(!r.ok){const t=await r.text().catch(()=>"" );throw new Error("HTTP "+r.status+" "+t)}
  const j=await r.json()
  const c=(j.choices&&j.choices[0]&&j.choices[0].message&&j.choices[0].message.content)||""
  return c
}

function profileBlock(){
  const age=document.getElementById("age").value
  const sex=document.getElementById("sex").value
  const height=document.getElementById("height").value
  const weight=document.getElementById("weight").value
  const activity=document.getElementById("activity").value
  const diet=document.getElementById("diet").value
  const goal=document.getElementById("goal").value
  return `Age: ${age}
Sex: ${sex}
Height: ${height} cm
Weight: ${weight} kg
Activity Level: ${activity}
Dietary Preference: ${diet}
Fitness Goal: ${goal}`
}

async function generatePlans(){
  const key=document.getElementById("apiKey").value.trim()
  const status=document.getElementById("status")
  const dietEl=document.getElementById("dietPlan")
  const fitEl=document.getElementById("fitPlan")
  if(!key){ui(status,true,"warn","Enter your Dobby API key");return}
  ui(status,true,"ok","Generating...")
  dietEl.innerHTML=""
  fitEl.innerHTML=""
  const profile=profileBlock()
  const dietMsg=[{role:"system",content:"You are a dietary expert. Create a one-day plan with breakfast, lunch, dinner, and two snacks. Tailor macros to the profile. Keep it specific, simple to follow, and formatted in clean markdown with headings and bullet lists. Include a short rationale."},{role:"user",content:`Profile:\n${profile}\nReturn sections: Rationale, Meal Plan, Shopping List.`}]
  const fitMsg=[{role:"system",content:"You are a fitness coach. Create a 7-day split tailored to the profile with warm-up, main sets, and cooldown. Include reps, sets, intensity guidance, and rest times. Format in markdown. Keep it realistic and safe."},{role:"user",content:`Profile:\n${profile}\nReturn sections: Overview, Day-by-Day Plan, Progression Notes.`}]
  try{
    const [diet,fit]=await Promise.all([callFireworks(dietMsg,key,0.5),callFireworks(fitMsg,key,0.5)])
    window.__ctx={diet,fit}
    document.getElementById("dietPlan").innerHTML=mdToHtml(diet)
    document.getElementById("fitPlan").innerHTML=mdToHtml(fit)
    ui(status,true,"ok","Plans generated")
  }catch(e){
    const corsHint=e.message.includes("TypeError: Failed to fetch")||e.message.includes("CORS")||e.message.includes("blocked")
    ui(status,true,"err",corsHint?"Request blocked by browser (CORS)":"Generation failed")
  }
}

async function checkKey(){
  const key=document.getElementById("apiKey").value.trim()
  const note=document.getElementById("apiNote")
  if(!key){ui(note,true,"warn","Enter a key to test");return}
  try{
    const c=await callFireworks([{role:"user",content:"Say OK"}],key,0.1)
    ui(note,true,"ok",c? "Key works":"Key check failed")
  }catch(e){
    const corsHint=e.message.includes("TypeError: Failed to fetch")||e.message.includes("CORS")||e.message.includes("blocked")
    ui(note,true,corsHint?"warn":"err",corsHint?"Blocked by CORS":"Invalid key or request failed")
  }
}

document.getElementById("gen").onclick=generatePlans
document.getElementById("checkBtn").onclick=checkKey
</script>
</body>
</html>
